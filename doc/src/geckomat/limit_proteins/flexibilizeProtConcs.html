<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of flexibilizeProtConcs</title>
  <meta name="keywords" content="flexibilizeProtConcs">
  <meta name="description" content="flexibilizeProtConcs">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">limit_proteins</a> &gt; flexibilizeProtConcs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\limit_proteins&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>flexibilizeProtConcs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>flexibilizeProtConcs</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> flexibilizeProtConcs
   Flexibilize protein concentration of an ecModel with constrained with
   proteomics data. The upper bound of the protein usage reaction is
   changed, while the concentrations in ecModel.ec.concs remain unchanged.

   If no (more) limiting enzyme concentrations can be found, it might be
   the protein pool exchange that is limiting growth. In that case, an
   attempt will be made to relax the protein pool exchange reaction, and
   if the growth rate indeed increases, it is suggested to set the protein
   pool exchange unconstrained (lb=-1000) before again running
   flexibilizeProtConcs. Such situations, where a proteomics integrated
   ecModel is overconstrained, may occur if the ecModel should be able to
   simulate maximum growth rate (from e.g. batch cultivation). 
   
   If relaxing the protein pool exchange does not increase the growth rate, then this
   is not due to enzyme constraints, but rather an issue with the
   metabolic network itself, or the set nutrient exchange is not
   sufficient.

 Input:
   model           an ecModel in GECKO 3 format (with ecModel.ec structure)
   expGrowth       estimated experimental growth rate. If not specified,
                   the value will be read from the model adapter
   foldChange      a value how much increase the protein concentration
                   (Optional, default = 2)
   iterPerEnzyme   the number of iterations that an enzyme can be increased.
                   A zero number can be defined. if zero is defined no limit
                   will be set, and it will increase the protein concentration
                   until reach de defined growth rate (Optional, default = 5)
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter)
   verbose         logical whether progress should be reported (Optional,
                   default true)

 Output:
   model           ecModel where the UB of measured protein have been increased
                   to allow reach a defined growth rate
   flexProt        array with information about flexibilized proteins
                   uniprotIDs  enzymes whose usage UB was flexibilized
                   oldConcs    original concentrations, from mode.ec.concs
                   flexConcs   flexibilized concentrations, new UB in
                               model
                   frequence   numeric how often the enzyme has been
                               step-wise flexibilized

 Usage:
   [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getConcControlCoeffs.html" class="code" title="function [enz, controlCoeffs] = getConcControlCoeffs(model, proteins, foldChange, limit)">getConcControlCoeffs</a>	getConcControlCoeffs</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</a>
0002 <span class="comment">% flexibilizeProtConcs</span>
0003 <span class="comment">%   Flexibilize protein concentration of an ecModel with constrained with</span>
0004 <span class="comment">%   proteomics data. The upper bound of the protein usage reaction is</span>
0005 <span class="comment">%   changed, while the concentrations in ecModel.ec.concs remain unchanged.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   If no (more) limiting enzyme concentrations can be found, it might be</span>
0008 <span class="comment">%   the protein pool exchange that is limiting growth. In that case, an</span>
0009 <span class="comment">%   attempt will be made to relax the protein pool exchange reaction, and</span>
0010 <span class="comment">%   if the growth rate indeed increases, it is suggested to set the protein</span>
0011 <span class="comment">%   pool exchange unconstrained (lb=-1000) before again running</span>
0012 <span class="comment">%   flexibilizeProtConcs. Such situations, where a proteomics integrated</span>
0013 <span class="comment">%   ecModel is overconstrained, may occur if the ecModel should be able to</span>
0014 <span class="comment">%   simulate maximum growth rate (from e.g. batch cultivation).</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   If relaxing the protein pool exchange does not increase the growth rate, then this</span>
0017 <span class="comment">%   is not due to enzyme constraints, but rather an issue with the</span>
0018 <span class="comment">%   metabolic network itself, or the set nutrient exchange is not</span>
0019 <span class="comment">%   sufficient.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% Input:</span>
0022 <span class="comment">%   model           an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0023 <span class="comment">%   expGrowth       estimated experimental growth rate. If not specified,</span>
0024 <span class="comment">%                   the value will be read from the model adapter</span>
0025 <span class="comment">%   foldChange      a value how much increase the protein concentration</span>
0026 <span class="comment">%                   (Optional, default = 2)</span>
0027 <span class="comment">%   iterPerEnzyme   the number of iterations that an enzyme can be increased.</span>
0028 <span class="comment">%                   A zero number can be defined. if zero is defined no limit</span>
0029 <span class="comment">%                   will be set, and it will increase the protein concentration</span>
0030 <span class="comment">%                   until reach de defined growth rate (Optional, default = 5)</span>
0031 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0032 <span class="comment">%                   default model adapter)</span>
0033 <span class="comment">%   verbose         logical whether progress should be reported (Optional,</span>
0034 <span class="comment">%                   default true)</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% Output:</span>
0037 <span class="comment">%   model           ecModel where the UB of measured protein have been increased</span>
0038 <span class="comment">%                   to allow reach a defined growth rate</span>
0039 <span class="comment">%   flexProt        array with information about flexibilized proteins</span>
0040 <span class="comment">%                   uniprotIDs  enzymes whose usage UB was flexibilized</span>
0041 <span class="comment">%                   oldConcs    original concentrations, from mode.ec.concs</span>
0042 <span class="comment">%                   flexConcs   flexibilized concentrations, new UB in</span>
0043 <span class="comment">%                               model</span>
0044 <span class="comment">%                   frequence   numeric how often the enzyme has been</span>
0045 <span class="comment">%                               step-wise flexibilized</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% Usage:</span>
0048 <span class="comment">%   [model, flexProt] = flexibilizeProtConcs(model, expGrowth, foldChange, iterPerEnzyme, modelAdapter, verbose)</span>
0049 
0050 <span class="keyword">if</span> nargin &lt; 6 || isempty(verbose)
0051     verbose = true;
0052 <span class="keyword">end</span>
0053 <span class="keyword">if</span> nargin &lt; 5 || isempty(modelAdapter)
0054     modelAdapter = ModelAdapterManager.getDefault();
0055     <span class="keyword">if</span> isempty(modelAdapter)
0056         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0057     <span class="keyword">end</span>
0058 <span class="keyword">end</span>
0059 params = modelAdapter.getParameters();
0060 
0061 <span class="keyword">if</span> nargin &lt; 4 || isempty(iterPerEnzyme)
0062     iterPerEnzyme = 5;
0063 <span class="keyword">end</span>
0064 
0065 <span class="keyword">if</span> nargin &lt; 3 || isempty(foldChange)
0066     foldChange = 2;
0067 <span class="keyword">end</span>
0068 
0069 <span class="keyword">if</span> nargin &lt; 2 || isempty(expGrowth)
0070     expGrowth = modelAdapter.getParameters().gR_exp;
0071 <span class="keyword">end</span>
0072 
0073 <span class="comment">% If a zero value is defined, not iteration limit will be set</span>
0074 <span class="keyword">if</span> iterPerEnzyme == 0
0075     iterPerEnzyme = inf;
0076 <span class="keyword">end</span>
0077 
0078 bioRxnIdx = getIndexes(model,params.bioRxn,<span class="string">'rxns'</span>);
0079 <span class="keyword">if</span> model.ub(bioRxnIdx) &lt; expGrowth
0080     fprintf([<span class="string">'The upper bound of the biomass reaction was %s, while expGrowth '</span><span class="keyword">...</span>
0081              <span class="string">'is %s. The upper bound has been set to expGrowth.'</span>],<span class="keyword">...</span>
0082              num2str(model.ub(bioRxnIdx)), num2str(expGrowth))
0083     model.ub(bioRxnIdx) = expGrowth;
0084 <span class="keyword">end</span>
0085 
0086 <span class="comment">% Keep track if protein pool will be flexibilized</span>
0087 changedProtPool = false;
0088 
0089 <span class="comment">% In case the model have not been protein constrained</span>
0090 <span class="comment">% model = constrainProtConcs(model);</span>
0091 
0092 [sol,hs] = solveLP(model);
0093 predGrowth = abs(sol.f);
0094 
0095 <span class="comment">% Get those proteins with a concentration defined</span>
0096 protConcs = find(~isnan(model.ec.concs));
0097 
0098 <span class="comment">% Get enzymes names with a concentration value</span>
0099 proteins = model.ec.enzymes(protConcs);
0100 
0101 <span class="comment">% Store how many time is predicted a enzyme with the highest coeff</span>
0102 frequence = zeros(numel(proteins),1);
0103 
0104 flexBreak=false;
0105 <span class="keyword">if</span> any(protConcs)
0106     <span class="keyword">while</span> predGrowth &lt; expGrowth
0107 
0108         <span class="comment">% Get the control coefficients</span>
0109         [~, controlCoeffs] = <a href="getConcControlCoeffs.html" class="code" title="function [enz, controlCoeffs] = getConcControlCoeffs(model, proteins, foldChange, limit)">getConcControlCoeffs</a>(model, proteins, foldChange, 0.75);
0110 
0111         <span class="comment">% Stop looking for limiting proteins all coeffs are zero</span>
0112         <span class="keyword">if</span> any(controlCoeffs)
0113 
0114             <span class="comment">% Find the maximum coefficient index</span>
0115             [~,maxIdx] = max(controlCoeffs);
0116 
0117             <span class="comment">% Increase +1 the frequence</span>
0118             frequence(maxIdx) = frequence(maxIdx) + 1;
0119 
0120             <span class="comment">% Allow to increase the UB maximum five times</span>
0121             <span class="keyword">if</span> frequence(maxIdx) &lt;= iterPerEnzyme
0122 
0123                 <span class="comment">% Set how much will increase the UB</span>
0124                 increase = foldChange*frequence(maxIdx);
0125 
0126                 <span class="comment">% Get usage rxn for the highest coeff</span>
0127                 protUsageIdx = strcmpi(model.rxns, strcat(<span class="string">'usage_prot_'</span>, proteins(maxIdx)));
0128 
0129                 <span class="comment">% replace the UB</span>
0130                 model.lb(protUsageIdx) = -(model.ec.concs(protConcs(maxIdx)) * (1+increase));
0131 
0132                 <span class="comment">% Get the new growth rate</span>
0133                 sol = solveLP(model,0,[],hs);
0134                 predGrowth = abs(sol.f);
0135 
0136                 <span class="keyword">if</span> verbose
0137                     disp([<span class="string">'Protein '</span> proteins{maxIdx} <span class="string">' LB adjusted. Grow: '</span> num2str(predGrowth)])
0138                 <span class="keyword">end</span>
0139             <span class="keyword">else</span>
0140                 disp([<span class="string">'Limit has been reached. Protein '</span>  proteins{maxIdx} <span class="string">' seems to be problematic. Consider changing the kcat.'</span>])
0141                 flexBreak=true;
0142                 <span class="keyword">break</span>
0143             <span class="keyword">end</span>
0144         <span class="keyword">else</span>
0145             disp(<span class="string">'No (more) limiting proteins have been found. Attempt to increase protein pool exchange.'</span>)
0146             protPoolIdx = getIndexes(model,<span class="string">'prot_pool_exchange'</span>,<span class="string">'rxns'</span>);
0147             oldProtPool = -model.lb(protPoolIdx);
0148             tempModel = setParam(model,<span class="string">'lb'</span>,protPoolIdx,-1000);
0149             tempModel = setParam(tempModel,<span class="string">'ub'</span>,bioRxnIdx,expGrowth);
0150             sol = solveLP(tempModel);
0151             <span class="keyword">if</span> (abs(sol.f)-predGrowth)&gt;1e-10 <span class="comment">% There is improvement in growth rate</span>
0152                 <span class="comment">% Find new protein pool constraint</span>
0153                 predGrowth = abs(sol.f);
0154                 tempModel = setParam(tempModel,<span class="string">'lb'</span>,bioRxnIdx,predGrowth);
0155                 tempModel = setParam(tempModel,<span class="string">'obj'</span>,protPoolIdx,1);
0156                 sol = solveLP(tempModel);
0157                 newProtPool = abs(sol.f);
0158                 model.lb(protPoolIdx) = -newProtPool;
0159                 fprintf([<span class="string">'Changing the lower bound of protein pool exchange from %s '</span>,<span class="keyword">...</span>
0160                          <span class="string">'to %s enabled a\ngrowth rate of %s. It can be helpful to set '</span>, <span class="keyword">...</span>
0161                          <span class="string">'the lower bound of protein\npool exchange to -1000 before '</span>,<span class="keyword">...</span>
0162                          <span class="string">'running flexibilizeProtConcs.\n'</span>],num2str(-oldProtPool), <span class="keyword">...</span>
0163                          num2str(-newProtPool),num2str(predGrowth));
0164                 changedProtPool = true;
0165             <span class="keyword">else</span>
0166                 fprintf([<span class="string">'Protein pool exchange not limiting. Inability to reach growth '</span>,<span class="keyword">...</span>
0167                         <span class="string">'rate is not related to\nenzyme constraints. Maximum growth rate '</span>,<span class="keyword">...</span>
0168                         <span class="string">'is %s.\n'</span>], num2str(predGrowth))
0169             <span class="keyword">end</span>
0170             <span class="comment">% To return an usable model with these conditions, set the</span>
0171             <span class="comment">% highest growth rate reached as the experimental value</span>
0172             expGrowth = predGrowth;
0173             <span class="keyword">break</span>
0174         <span class="keyword">end</span>
0175     <span class="keyword">end</span>
0176 <span class="keyword">else</span>
0177     error(<span class="string">'Protein concentrations have not been defined. Please run readProteomics and constrainProtConcs'</span>)
0178 <span class="keyword">end</span>
0179 
0180 protFlex        = proteins(frequence&gt;0);
0181 protUsageIdx    = find(ismember(model.rxns, strcat(<span class="string">'usage_prot_'</span>, protFlex)));
0182 ecProtId        = find(ismember(model.ec.enzymes,protFlex));
0183 oldConcs        = model.ec.concs(ecProtId);
0184 
0185 <span class="keyword">if</span> flexBreak == false &amp;&amp; ~isempty(protFlex)
0186     <span class="comment">% Not all flexibilized proteins require flexibilization in the end</span>
0187     <span class="comment">% Test flux distribution with minimum prot_pool usage</span>
0188     modelTemp       = setParam(model,<span class="string">'var'</span>,params.bioRxn,expGrowth,0.5);
0189     modelTemp       = setParam(modelTemp,<span class="string">'obj'</span>,<span class="string">'prot_pool_exchange'</span>,1);
0190     sol             = solveLP(modelTemp,1);
0191     <span class="comment">% Check which concentrations can remain unchanged</span>
0192     newConcs        = abs(sol.x(protUsageIdx));
0193     keepOld         = newConcs&lt;oldConcs;
0194     <span class="comment">% Set UBs</span>
0195     model.lb(protUsageIdx(keepOld))  = -oldConcs(keepOld);
0196     model.lb(protUsageIdx(~keepOld)) = -newConcs(~keepOld);
0197     <span class="comment">% Output structure</span>
0198     protFlex(keepOld) = [];
0199     oldConcs(keepOld) = [];
0200     newConcs(keepOld) = [];
0201     frequence=frequence(frequence&gt;0);
0202     frequence(keepOld) = [];
0203     
0204     flexProt.uniprotIDs = protFlex;
0205     flexProt.oldConcs   = oldConcs;
0206     flexProt.flexConcs  = newConcs;
0207     flexProt.frequence  = frequence(frequence&gt;0);
0208 <span class="keyword">else</span>
0209     protFlex        = proteins(frequence&gt;0);
0210     protUsageIdx    = find(ismember(model.rxns, strcat(<span class="string">'usage_prot_'</span>, protFlex)));
0211 
0212     flexProt.uniprotIDs = protFlex;
0213     flexProt.oldConcs   = model.ec.concs(ecProtId);
0214     flexProt.flexConcs  = abs(model.lb(protUsageIdx));
0215     flexProt.frequence  = frequence(frequence&gt;0);
0216 <span class="keyword">end</span>
0217 <span class="keyword">if</span> changedProtPool
0218     flexProt.uniprotIDs(end+1) = {<span class="string">'prot_pool'</span>};
0219     flexProt.oldConcs(end+1)   = oldProtPool;
0220     flexProt.flexConcs(end+1)  = newProtPool;
0221     flexProt.frequence(end+1)  = 1;
0222 <span class="keyword">end</span>
0223 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>