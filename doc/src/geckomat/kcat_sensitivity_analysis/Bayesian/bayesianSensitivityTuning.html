<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of bayesianSensitivityTuning</title>
  <meta name="keywords" content="bayesianSensitivityTuning">
  <meta name="description" content="bayesianSensitivityTuning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="../index.html">kcat_sensitivity_analysis</a> &gt; <a href="index.html">Bayesian</a> &gt; bayesianSensitivityTuning.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\kcat_sensitivity_analysis\Bayesian&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>bayesianSensitivityTuning
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>bayesianSensitivityTuning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function ecModel = bayesianSensitivityTuning(ecModel,modelAdapter,maxIterations) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> bayesianSensitivityTuning
   Modifies kcats to better fit experimental data. Currently only works with 
   light models.

 Input:
   ecModel         ecModel that was generated by makeEcModel, or loaded from
                   an earlier run. Not compatible with ecModels generated by
                   earlier GECKO versions (pre 3.0).
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter).
   maxIterations   The maximum number of iterations to run (Optional, default 150)

 Output:
   model           ecModel with new kcats, not applied.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="abc_max.html" class="code" title="function [rmse_final,exp,simulated,growthdata,max_growth]=abc_max(ecModel,kcat_random_all,growthdata,max_growth,proc,sample_generation,j,rxn2block)">abc_max</a>	setProtPoolSize</li><li><a href="getrSample.html" class="code" title="function r = getrSample(mu,sigma,step,method)">getrSample</a>	getrSample</li><li><a href="updateprior.html" class="code" title="function [a,b] = updateprior(x)">updateprior</a>	updateprior</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function ecModel = bayesianSensitivityTuning(ecModel,modelAdapter,maxIterations)</a>
0002 <span class="comment">% bayesianSensitivityTuning</span>
0003 <span class="comment">%   Modifies kcats to better fit experimental data. Currently only works with</span>
0004 <span class="comment">%   light models.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input:</span>
0007 <span class="comment">%   ecModel         ecModel that was generated by makeEcModel, or loaded from</span>
0008 <span class="comment">%                   an earlier run. Not compatible with ecModels generated by</span>
0009 <span class="comment">%                   earlier GECKO versions (pre 3.0).</span>
0010 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0011 <span class="comment">%                   default model adapter).</span>
0012 <span class="comment">%   maxIterations   The maximum number of iterations to run (Optional, default 150)</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Output:</span>
0015 <span class="comment">%   model           ecModel with new kcats, not applied.</span>
0016 <span class="comment">%</span>
0017 
0018 <span class="keyword">if</span> nargin &lt; 3
0019     maxIterations = 150;
0020 <span class="keyword">end</span>
0021 
0022 <span class="keyword">if</span> nargin &lt; 2 || isempty(modelAdapter)
0023     modelAdapter = ModelAdapterManager.getDefault();
0024     <span class="keyword">if</span> isempty(modelAdapter)
0025         error(<span class="string">'Either send in a modelAdapter or set the default ecModel adapter in the ModelAdapterManager.'</span>)
0026     <span class="keyword">end</span>
0027 <span class="keyword">end</span>
0028 
0029 basePath = modelAdapter.getParameters().path;
0030 
0031 growthdata = table2cell(readtable(fullfile(basePath,<span class="string">'data'</span>,<span class="string">'BayesianGrowthRates.csv'</span>)));
0032 max_growth = table2cell(readtable(fullfile(basePath,<span class="string">'data'</span>,<span class="string">'BayesianMaxGrowth.csv'</span>)));
0033 rxn2block = table2cell(readtable(fullfile(basePath,<span class="string">'data'</span>,<span class="string">'BayesianRxn2Block.csv'</span>), <span class="string">'Delimiter'</span>, <span class="string">','</span>));
0034 
0035 proc = 18;
0036 numPerGeneration = 126;
0037 rejectnum = 0.2;
0038 
0039 <span class="comment">%these will be updated in the loop below</span>
0040 kcats = ecModel.ec.kcat;
0041 kcat_var = ones(length(ecModel.ec.kcat),1);
0042 
0043 D = <a href="abc_max.html" class="code" title="function [rmse_final,exp,simulated,growthdata,max_growth]=abc_max(ecModel,kcat_random_all,growthdata,max_growth,proc,sample_generation,j,rxn2block)">abc_max</a>(ecModel,kcats,growthdata,max_growth,1,1,1,rxn2block);
0044 D_100 = D;
0045 theta_100 = [];
0046 kcat_100 = [];
0047 sampledgeneration = 1;
0048 <span class="keyword">while</span> D &gt; rejectnum &amp;&amp; D_100 &gt; 0.5 <span class="comment">% range for D_1 to D_100 is within 0.3 and D_100 should &lt; 0.5</span>
0049     <span class="keyword">if</span> sampledgeneration &lt;= maxIterations
0050         disp([<span class="string">'Running '</span> num2str(sampledgeneration) <span class="string">' of '</span> num2str(maxIterations) <span class="string">': D = '</span> num2str(D) <span class="string">' D_100 = '</span> num2str(D_100)])
0051         old = theta_100;
0052         kcat_old_100 = kcat_100;
0053 
0054         <span class="keyword">if</span> sampledgeneration == 1
0055             sample_generation = 144;
0056         <span class="keyword">else</span>
0057             sample_generation = numPerGeneration;
0058         <span class="keyword">end</span>
0059         <span class="comment">% generate one maxIterations sample of kcats</span>
0060         kcat_random_all = arrayfun(@<a href="getrSample.html" class="code" title="function r = getrSample(mu,sigma,step,method)">getrSample</a>, kcats, kcat_var,repmat(sample_generation,length(kcats),1),<span class="string">'UniformOutput'</span>,false);
0061         kcat_random_all = cell2mat(kcat_random_all);
0062         <span class="comment">%Simulate and measure RMSE</span>
0063         parfor j = 1:proc
0064             rmse_final = <a href="abc_max.html" class="code" title="function [rmse_final,exp,simulated,growthdata,max_growth]=abc_max(ecModel,kcat_random_all,growthdata,max_growth,proc,sample_generation,j,rxn2block)">abc_max</a>(ecModel,kcat_random_all,growthdata,max_growth,proc,sample_generation,j,rxn2block)
0065             new_tmp{j} = rmse_final;
0066         <span class="keyword">end</span>
0067         
0068         new = cell2mat(new_tmp);
0069         theta = [new,old];
0070         kcat = [kcat_random_all,kcat_old_100];
0071 
0072         <span class="comment">% Initialize an empty set to store the best 100  after each step</span>
0073         [~,D_idx]= sort(theta,<span class="string">'ascend'</span>);
0074         theta_100 = theta(D_idx(1:100));
0075         D = abs(theta_100(100)-theta_100(1)); <span class="comment">% the largest one theta - smallest theta</span>
0076         D_100 = theta_100(100);
0077         kcat_100 = kcat(:,D_idx(1:100));
0078         <span class="comment">%writematrix([kcat_100;repmat(tot_prot_weight,1,length(theta_100));theta_100],['kcat_genra',num2str(sampledgeneration),'.txt'])</span>
0079 
0080         <span class="comment">% recalculate the sigma and mu</span>
0081         ss = num2cell(kcat_100',1);
0082         [a,b] = arrayfun(@<a href="updateprior.html" class="code" title="function [a,b] = updateprior(x)">updateprior</a>,ss);
0083         kcats = a';
0084         kcat_var = b';
0085         sampledgeneration = sampledgeneration + 1;
0086     <span class="keyword">else</span>
0087         D = rejectnum;
0088         D_100 = D;
0089     <span class="keyword">end</span>
0090 <span class="keyword">end</span>
0091 
0092 ecModel.ec.kcat = kcats;
0093 
0094 <span class="keyword">end</span>
0095 <span class="comment">%code for generating data files from the .mat files in dlkcat</span>
0096 <span class="comment">%x = load('C:/Code/Components/GECKO/Gecko3/GECKO/tutorials/tutorial_yeast-GEM/data/Saccharomyces_cerevisiae_dl.mat')</span>
0097 <span class="comment">%growthrates = x.growthrates;</span>
0098 <span class="comment">%growthrates(strcmp(growthrates(:,1),'Saccharomyces_cerevisiae'),:)</span>
0099 <span class="comment">%size(growthrates)</span>
0100 <span class="comment">%T = cell2table(growthrates(strcmp(growthrates(:,1),'Saccharomyces_cerevisiae'),:),'VariableNames',{'Species','Substrate','Uptake','sub','ace','eth','gly','pyr','ethyl_acetate','co2','o2','Unused1','Unused2','OxAvail','Unused3','Media'});</span>
0101 <span class="comment">%writetable(T,'C:/Code/Components/GECKO/Gecko3/GECKO/tutorials/tutorial_yeast-GEM/data/BayesianGrowthRates.csv');</span>
0102 <span class="comment">%maxGrowth = cell2table(x.max_growth, 'VariableNames', {'Species','Substrate','Uptake','sub','ace','eth','gly','pyr','ethyl_acetate','co2','o2','Unused1','Unused2','OxAvail','Unused3','Media'});</span>
0103 <span class="comment">%writetable(maxGrowth, 'C:/Code/Components/GECKO/Gecko3/GECKO/tutorials/tutorial_yeast-GEM/data/BayesianMaxGrowth.csv')</span>
0104 <span class="comment">%rxn2block = x.rxn2block;</span>
0105 <span class="comment">%T = cell2table(rxn2block,'VariableNames',{'Rxns'});</span>
0106 <span class="comment">%writetable(T,'C:/Code/Components/GECKO/Gecko3/GECKO/tutorials/tutorial_yeast-GEM/data/BayesianRxn2Block.csv');</span>
0107 
0108</pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>