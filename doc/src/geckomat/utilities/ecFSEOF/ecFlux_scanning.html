<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ecFlux_scanning</title>
  <meta name="keywords" content="ecFlux_scanning">
  <meta name="description" content="ecFlux_scanning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="../index.html">utilities</a> &gt; <a href="index.html">ecFSEOF</a> &gt; ecFlux_scanning.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\utilities\ecFSEOF&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>ecFlux_scanning
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>ecFlux_scanning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function FC = ecFlux_scanning(ecModel,targetRxn,csRxn,alpha,tolerance,filterG) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">ecFlux_scanning

 Input:
   ecModel         an ecModel in GECKO 3 format (with ecModel.ec structure).
   targetRxn       rxn ID for the production target reaction, a exchange
                   reaction is recommended.
   csRxn           rxn ID for the main carbon source uptake reaction.
   alpha           scalling factor for production yield for enforced objective
                   limits
   tolerance       numerical tolerance for fixing bounds.
                   (Optional, defaul 1E-4)
   filterG         logical value. TRUE if genes K_scores results should be
                   filtered according to the alpha vector distribution
                   (Optional, defaul false)

 Usage:
   FC = ecFlux_scanning(model,targetRxn,csRxn,alpha,tolerance,filterG)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="run_ecFSEOF.html" class="code" title="function results = run_ecFSEOF(ecModel,targetRxn,csRxn,alphaLims,nSteps,file_genes,file_rxns,modelAdapter)">run_ecFSEOF</a>	run_ecFSEOF</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function FC = ecFlux_scanning(ecModel,targetRxn,csRxn,alpha,tolerance,filterG)</a>
0002 <span class="comment">%ecFlux_scanning</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Input:</span>
0005 <span class="comment">%   ecModel         an ecModel in GECKO 3 format (with ecModel.ec structure).</span>
0006 <span class="comment">%   targetRxn       rxn ID for the production target reaction, a exchange</span>
0007 <span class="comment">%                   reaction is recommended.</span>
0008 <span class="comment">%   csRxn           rxn ID for the main carbon source uptake reaction.</span>
0009 <span class="comment">%   alpha           scalling factor for production yield for enforced objective</span>
0010 <span class="comment">%                   limits</span>
0011 <span class="comment">%   tolerance       numerical tolerance for fixing bounds.</span>
0012 <span class="comment">%                   (Optional, defaul 1E-4)</span>
0013 <span class="comment">%   filterG         logical value. TRUE if genes K_scores results should be</span>
0014 <span class="comment">%                   filtered according to the alpha vector distribution</span>
0015 <span class="comment">%                   (Optional, defaul false)</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Usage:</span>
0018 <span class="comment">%   FC = ecFlux_scanning(model,targetRxn,csRxn,alpha,tolerance,filterG)</span>
0019 
0020 <span class="keyword">if</span> nargin &lt; 6 || isempty(filterG)
0021     filterG = false;
0022 <span class="keyword">end</span>
0023 
0024 <span class="keyword">if</span> nargin &lt; 5 || isempty(tolerance)
0025     tolerance = 1E-4;
0026 <span class="keyword">end</span>
0027 
0028 <span class="comment">% Simulate WT (100% growth):</span>
0029 [~, FC.flux_WT] = getFluxTarget(ecModel,targetRxn,csRxn);
0030 
0031 <span class="comment">% Set to zero values which are under solver tolerance</span>
0032 FC.flux_WT(abs(FC.flux_WT) &lt; 1e-8) = 0; 
0033 
0034 <span class="comment">% Simulate forced (X% growth and the rest towards product) based on yield:</span>
0035 FC.alpha = alpha;
0036 
0037 <span class="comment">% Initialize fluxes and K_scores matrices</span>
0038 v_matrix = zeros(length(ecModel.rxns),length(alpha));
0039 k_matrix = zeros(length(ecModel.rxns),length(alpha));
0040 <span class="keyword">for</span> i = 1:length(alpha)
0041     <span class="comment">%disp(['Iteration #' num2str(i)])</span>
0042     [~, FC.flux_MAX] = getFluxTarget(ecModel,targetRxn,csRxn,alpha(i));
0043     <span class="comment">% Set to zero values which are under solver tolerance</span>
0044     FC.flux_MAX(abs(FC.flux_MAX) &lt; 1e-8) = 0;
0045     v_matrix(:,i) = FC.flux_MAX;
0046     k_matrix(:,i) = FC.flux_MAX./FC.flux_WT;
0047 <span class="keyword">end</span>
0048 
0049 <span class="comment">% Take out rxns with no grRule:</span>
0050 withGR   = ~cellfun(@isempty,ecModel.grRules);
0051 
0052 <span class="comment">% Generate rxn equations:</span>
0053 rxnEqs   = constructEquations(ecModel,withGR,true);
0054 v_matrix = v_matrix(withGR,:);
0055 k_matrix = k_matrix(withGR,:);
0056 rxnGeneM = ecModel.rxnGeneMat(withGR,:);
0057 FC.rxns  = [ecModel.rxns(withGR),ecModel.rxnNames(withGR),ecModel.grRules(withGR),rxnEqs];
0058 
0059 <span class="comment">% Filter out rxns that are always zero -&gt; k=0/0=NaN:</span>
0060 non_nan  = sum(~isnan(k_matrix),2) &gt; 0;
0061 v_matrix = v_matrix(non_nan,:);
0062 k_matrix = k_matrix(non_nan,:);
0063 rxnGeneM = rxnGeneM(non_nan,:);
0064 FC.rxns  = FC.rxns(non_nan,:);
0065 
0066 <span class="comment">% Replace remaining NaNs with 1s:</span>
0067 k_matrix(isnan(k_matrix)) = 1;
0068 
0069 <span class="comment">% Replace any Inf value with 1000 (maximum value is ~700):</span>
0070 k_matrix(k_matrix&gt;1000) = 1000;
0071 k_matrix(k_matrix&lt;-1000) = 1000;
0072 
0073 <span class="comment">% Filter out values that are inconsistent at different alphas:</span>
0074 always_down  = sum(k_matrix &lt;= 1,2) == length(alpha);
0075 always_up    = sum(k_matrix &gt;= 1,2) == length(alpha);
0076 
0077 <span class="comment">% Identify those reactions with mixed patterns</span>
0078 incons_rxns  = always_down + always_up == 0;
0079 
0080 <span class="comment">% Identify genes that are linked to &quot;inconsistent rxns&quot;</span>
0081 incons_genes = sum(rxnGeneM(incons_rxns,:),1) &gt; 0;
0082 
0083 <span class="comment">% Finally, inconsistent reactions are those that are not conected</span>
0084 <span class="comment">% to &quot;inconsistent genes&quot; from the original &quot;inconsistent rxns&quot; set</span>
0085 incons_rxns  = sum(rxnGeneM(:,incons_genes),2) &gt; 0;
0086 
0087 <span class="comment">% Keep results for the consistent rxns exclusively</span>
0088 v_matrix     = v_matrix(~incons_rxns,:);
0089 k_matrix     = k_matrix(~incons_rxns,:);
0090 rxnGeneM     = rxnGeneM(~incons_rxns,:);
0091 FC.rxns      = FC.rxns(~incons_rxns,:);
0092 
0093 <span class="comment">% Get median k score across steps</span>
0094 FC.k_rxns   = mean(k_matrix,2);
0095 
0096 <span class="comment">% Order from highest to lowest median k_score (across alphas)</span>
0097 [~,order]   = sort(FC.k_rxns,<span class="string">'descend'</span>);
0098 FC.k_rxns   = FC.k_rxns(order,:);
0099 FC.v_matrix = v_matrix(order,:);
0100 FC.k_matrix = k_matrix(order,:);
0101 rxnGeneM    = rxnGeneM(order,:);
0102 FC.rxns     = FC.rxns(order,:);
0103 
0104 <span class="comment">% Create list of remaining genes and filter out any inconsistent score:</span>
0105 <span class="comment">% Just those genes that are connected to the remaining rxns are</span>
0106 FC.genes     = ecModel.genes(sum(rxnGeneM,1) &gt; 0);
0107 FC.geneNames = ecModel.geneShortNames(sum(rxnGeneM,1) &gt; 0);
0108 FC.k_genes   = zeros(size(FC.genes));
0109 cons_genes   = false(size(FC.genes));
0110 rxnGeneM     = rxnGeneM(:,sum(rxnGeneM,1) &gt; 0);
0111 
0112 <span class="keyword">for</span> i = 1:length(FC.genes)
0113     <span class="comment">% Extract all the K_scores (from rxns across alphas) conected to</span>
0114     <span class="comment">% each remaining gene</span>
0115     k_set         = FC.k_rxns(rxnGeneM(:,i) &gt; 0);
0116     <span class="comment">% Check the kind of control that gene i-th exerts over its reactions</span>
0117     always_down   = sum(k_set &lt;= (1-tolerance)) == length(k_set);
0118     always_up     = sum(k_set &gt;= (1+tolerance)) == length(k_set);
0119     <span class="comment">% Evaluate if gene is always exerting either a positive or negative</span>
0120     <span class="comment">% control</span>
0121     cons_genes(i) = always_down + always_up == 1;
0122     FC.k_genes(i) = mean(k_set);
0123 <span class="keyword">end</span>
0124 <span class="comment">% Keep &quot;consistent genes&quot;</span>
0125 FC.genes     = FC.genes(cons_genes);
0126 FC.geneNames = FC.geneNames(cons_genes);
0127 FC.k_genes   = FC.k_genes(cons_genes);
0128 rxnGeneM     = rxnGeneM(:,cons_genes);
0129 
0130 <span class="keyword">if</span> filterG
0131     <span class="comment">% Filter any value between mean(alpha) and 1:</span>
0132     unchanged    = (FC.k_genes &gt;= mean(alpha) - tolerance) + (FC.k_genes &lt;= 1 + tolerance) == 2;
0133     FC.genes     = FC.genes(~unchanged);
0134     FC.geneNames = FC.geneNames(~unchanged);
0135     FC.k_genes   = FC.k_genes(~unchanged);
0136     rxnGeneM     = rxnGeneM(:,~unchanged);
0137     <span class="comment">% Update results for rxns-related fields (remove remaining reactions</span>
0138     <span class="comment">% without any associated gene in rxnGeneM)</span>
0139     toKeep      = (sum(rxnGeneM,2) &gt; 0);
0140     FC.k_rxns   = FC.k_rxns(toKeep,:);
0141     FC.v_matrix = v_matrix(toKeep,:);
0142     FC.k_matrix = k_matrix(toKeep,:);
0143     FC.rxns     = FC.rxns(toKeep,:);
0144 <span class="keyword">end</span>
0145 
0146 <span class="comment">% Order from highest to lowest k:</span>
0147 [~,order]    = sort(FC.k_genes,<span class="string">'descend'</span>);
0148 FC.genes     = FC.genes(order,:);
0149 FC.geneNames = FC.geneNames(order,:);
0150 FC.k_genes   = FC.k_genes(order,:);
0151 
0152 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>