<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ecFlux_scanning</title>
  <meta name="keywords" content="ecFlux_scanning">
  <meta name="description" content="ecFlux_scanning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="../index.html">utilities</a> &gt; <a href="index.html">ecFSEOF</a> &gt; ecFlux_scanning.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\utilities\ecFSEOF&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>ecFlux_scanning
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>ecFlux_scanning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function FC = ecFlux_scanning(ecModel,target,cSource,alpha,tolerance,filterG) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">ecFlux_scanning

 Input:
   ecModel         an ecModel in GECKO 3 format (with ecModel.ec structure).
   rxnTarget       rxn ID for the production target reaction, a exchange
                   reaction is recommended.
  cSource          rxn ID for the main carbon source uptake reaction.
   alpha           scalling factor for production yield for enforced objective
                   limits
   tolerance       numerical tolerance for fixing bounds.
                   (Optional, defaul 1E-4)
   filterG         logical value. TRUE if genes K_scores results should be
                   filtered according to the alpha vector distribution
                   (Optional, defaul false)

 Usage:
   FC = ecFlux_scanning(model,target,cSource,alpha,tolerance,filterG)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="run_ecFSEOF.html" class="code" title="function results = run_ecFSEOF(ecModel,rxnTarget,cSource,alphaLims,Nsteps,file_genes,file_rxns,modelAdapter)">run_ecFSEOF</a>	run_ecFSEOF</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function FC = ecFlux_scanning(ecModel,target,cSource,alpha,tolerance,filterG)</a>
0002 <span class="comment">%ecFlux_scanning</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Input:</span>
0005 <span class="comment">%   ecModel         an ecModel in GECKO 3 format (with ecModel.ec structure).</span>
0006 <span class="comment">%   rxnTarget       rxn ID for the production target reaction, a exchange</span>
0007 <span class="comment">%                   reaction is recommended.</span>
0008 <span class="comment">%  cSource          rxn ID for the main carbon source uptake reaction.</span>
0009 <span class="comment">%   alpha           scalling factor for production yield for enforced objective</span>
0010 <span class="comment">%                   limits</span>
0011 <span class="comment">%   tolerance       numerical tolerance for fixing bounds.</span>
0012 <span class="comment">%                   (Optional, defaul 1E-4)</span>
0013 <span class="comment">%   filterG         logical value. TRUE if genes K_scores results should be</span>
0014 <span class="comment">%                   filtered according to the alpha vector distribution</span>
0015 <span class="comment">%                   (Optional, defaul false)</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Usage:</span>
0018 <span class="comment">%   FC = ecFlux_scanning(model,target,cSource,alpha,tolerance,filterG)</span>
0019 
0020 <span class="keyword">if</span> nargin &lt; 6 || isempty(filterG)
0021     filterG = false;
0022 <span class="keyword">end</span>
0023 
0024 <span class="keyword">if</span> nargin &lt; 5 || isempty(tolerance)
0025     tolerance = 1E-4;
0026 <span class="keyword">end</span>
0027 
0028 <span class="comment">% Simulate WT (100% growth):</span>
0029 [~, FC.flux_WT] = getFluxTarget(ecModel,target,cSource);
0030 
0031 <span class="comment">% Simulate forced (X% growth and the rest towards product) based on yield:</span>
0032 FC.alpha = alpha;
0033 
0034 <span class="comment">% Initialize fluxes and K_scores matrices</span>
0035 v_matrix = zeros(length(ecModel.rxns),length(alpha));
0036 k_matrix = zeros(length(ecModel.rxns),length(alpha));
0037 <span class="keyword">for</span> i = 1:length(alpha)
0038     <span class="comment">%disp(['Iteration #' num2str(i)])</span>
0039     [~, FC.flux_MAX] = getFluxTarget(ecModel,target,cSource,alpha(i));
0040     v_matrix(:,i) = FC.flux_MAX;
0041     k_matrix(:,i) = FC.flux_MAX./FC.flux_WT;
0042 <span class="keyword">end</span>
0043 
0044 <span class="comment">% Take out rxns with no grRule:</span>
0045 withGR   = ~cellfun(@isempty,ecModel.grRules);
0046 
0047 <span class="comment">% Generate rxn equations:</span>
0048 rxnEqs   = constructEquations(ecModel,ecModel.rxns(withGR),true);
0049 v_matrix = v_matrix(withGR,:);
0050 k_matrix = k_matrix(withGR,:);
0051 rxnGeneM = ecModel.rxnGeneMat(withGR,:);
0052 FC.rxns  = [ecModel.rxns(withGR),ecModel.rxnNames(withGR),ecModel.grRules(withGR),rxnEqs];
0053 
0054 <span class="comment">% Filter out rxns that are always zero -&gt; k=0/0=NaN:</span>
0055 non_nan  = sum(~isnan(k_matrix),2) &gt; 0;
0056 v_matrix = v_matrix(non_nan,:);
0057 k_matrix = k_matrix(non_nan,:);
0058 rxnGeneM = rxnGeneM(non_nan,:);
0059 FC.rxns  = FC.rxns(non_nan,:);
0060 
0061 <span class="comment">% Replace remaining NaNs with 1s:</span>
0062 k_matrix(isnan(k_matrix)) = 1;
0063 
0064 <span class="comment">% Replace any Inf value with 1000 (maximum value is ~700):</span>
0065 k_matrix(k_matrix&gt;1000) = 1000;
0066 
0067 <span class="comment">% Filter out values that are inconsistent at different alphas:</span>
0068 always_down  = sum(k_matrix &lt;= 1,2) == length(alpha);
0069 always_up    = sum(k_matrix &gt;= 1,2) == length(alpha);
0070 
0071 <span class="comment">% Identify those reactions with mixed patterns</span>
0072 incons_rxns  = always_down + always_up == 0;
0073 
0074 <span class="comment">% Identify genes that are linked to &quot;inconsistent rxns&quot;</span>
0075 incons_genes = sum(rxnGeneM(incons_rxns,:),1) &gt; 0;
0076 
0077 <span class="comment">% Finally, inconsistent reactions are those that are not conected</span>
0078 <span class="comment">% to &quot;inconsistent genes&quot; from the original &quot;inconsistent rxns&quot; set</span>
0079 incons_rxns  = sum(rxnGeneM(:,incons_genes),2) &gt; 0;
0080 
0081 <span class="comment">% Keep results for the consistent rxns exclusively</span>
0082 v_matrix     = v_matrix(~incons_rxns,:);
0083 k_matrix     = k_matrix(~incons_rxns,:);
0084 rxnGeneM     = rxnGeneM(~incons_rxns,:);
0085 FC.rxns      = FC.rxns(~incons_rxns,:);
0086 
0087 <span class="comment">% Get median k score across steps</span>
0088 FC.k_rxns   = mean(k_matrix,2);
0089 
0090 <span class="comment">% Order from highest to lowest median k_score (across alphas)</span>
0091 [~,order]   = sort(FC.k_rxns,<span class="string">'descend'</span>);
0092 FC.k_rxns   = FC.k_rxns(order,:);
0093 FC.v_matrix = v_matrix(order,:);
0094 FC.k_matrix = k_matrix(order,:);
0095 rxnGeneM    = rxnGeneM(order,:);
0096 FC.rxns     = FC.rxns(order,:);
0097 
0098 <span class="comment">% Create list of remaining genes and filter out any inconsistent score:</span>
0099 <span class="comment">% Just those genes that are connected to the remaining rxns are</span>
0100 FC.genes     = ecModel.genes(sum(rxnGeneM,1) &gt; 0);
0101 FC.geneNames = ecModel.geneShortNames(sum(rxnGeneM,1) &gt; 0);
0102 FC.k_genes   = zeros(size(FC.genes));
0103 cons_genes   = false(size(FC.genes));
0104 rxnGeneM     = rxnGeneM(:,sum(rxnGeneM,1) &gt; 0);
0105 
0106 <span class="keyword">for</span> i = 1:length(FC.genes)
0107     <span class="comment">% Extract all the K_scores (from rxns across alphas) conected to</span>
0108     <span class="comment">% each remaining gene</span>
0109     k_set         = FC.k_rxns(rxnGeneM(:,i) &gt; 0);
0110     <span class="comment">% Check the kind of control that gene i-th exerts over its reactions</span>
0111     always_down   = sum(k_set &lt;= (1-tolerance)) == length(k_set);
0112     always_up     = sum(k_set &gt;= (1+tolerance)) == length(k_set);
0113     <span class="comment">% Evaluate if gene is always exerting either a positive or negative</span>
0114     <span class="comment">% control</span>
0115     cons_genes(i) = always_down + always_up == 1;
0116     FC.k_genes(i) = mean(k_set);
0117 <span class="keyword">end</span>
0118 <span class="comment">% Keep &quot;consistent genes&quot;</span>
0119 FC.genes     = FC.genes(cons_genes);
0120 FC.geneNames = FC.geneNames(cons_genes);
0121 FC.k_genes   = FC.k_genes(cons_genes);
0122 rxnGeneM     = rxnGeneM(:,cons_genes);
0123 
0124 <span class="keyword">if</span> filterG
0125     <span class="comment">% Filter any value between mean(alpha) and 1:</span>
0126     unchanged    = (FC.k_genes &gt;= mean(alpha) - tolerance) + (FC.k_genes &lt;= 1 + tolerance) == 2;
0127     FC.genes     = FC.genes(~unchanged);
0128     FC.geneNames = FC.geneNames(~unchanged);
0129     FC.k_genes   = FC.k_genes(~unchanged);
0130     rxnGeneM     = rxnGeneM(:,~unchanged);
0131     <span class="comment">% Update results for rxns-related fields (remove remaining reactions</span>
0132     <span class="comment">% without any associated gene in rxnGeneM)</span>
0133     toKeep      = (sum(rxnGeneM,2) &gt; 0);
0134     FC.k_rxns   = FC.k_rxns(toKeep,:);
0135     FC.v_matrix = v_matrix(toKeep,:);
0136     FC.k_matrix = k_matrix(toKeep,:);
0137     FC.rxns     = FC.rxns(toKeep,:);
0138 <span class="keyword">end</span>
0139 
0140 <span class="comment">% Order from highest to lowest k:</span>
0141 [~,order]    = sort(FC.k_genes,<span class="string">'descend'</span>);
0142 FC.genes     = FC.genes(order,:);
0143 FC.geneNames = FC.geneNames(order,:);
0144 FC.k_genes   = FC.k_genes(order,:);
0145 
0146 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>