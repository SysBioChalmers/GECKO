<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of applyComplexData</title>
  <meta name="keywords" content="applyComplexData">
  <meta name="description" content="applyComplexData">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">change_model</a> &gt; applyComplexData.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\change_model&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>applyComplexData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>applyComplexData</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, foundComplex, proposedComplex] = applyComplexData(model, complexInfo, modelAdapter, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> applyComplexData
   Apply stochiometry for complex in an ecModel

 Input:
   model           an ecModel in GECKO 3 format (with ecModel.ec structure)
   complexInfo     structure as generated by getComplexData. If nothing
                   is provided, an attempt will be made to read
                   data/ComplexPortal.json from the obj.params.path folder
                   specified in the modelAdapter.
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter).
   verbose         logical if a summary should be shown in the Command
                   Window (Optional, default true)

 Output:
   model           ecModel where model.ec.rxnEnzMat is populated with
                   subunit stochiometries
   foundComplex    complexes that fully matched between the model and the
                   complex data
   proposedComplex complexes where the model contained &gt;75% but &lt;100% of
                   the proteins indicated by Complex Portal, or where the
                   model contained more proteins than indicated for that
                   complex in Complex Portal.

 Usage:
   [model, foundComplex, proposedComplex] = applyComplexData(ecModel, complexInfo, modelAdapter);</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getComplexData.html" class="code" title="function complexInfo = getComplexData(taxonomicID, modelAdapter)">getComplexData</a>	getComplexData</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, foundComplex, proposedComplex] = applyComplexData(model, complexInfo, modelAdapter, verbose)</a>
0002 <span class="comment">% applyComplexData</span>
0003 <span class="comment">%   Apply stochiometry for complex in an ecModel</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model           an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0007 <span class="comment">%   complexInfo     structure as generated by getComplexData. If nothing</span>
0008 <span class="comment">%                   is provided, an attempt will be made to read</span>
0009 <span class="comment">%                   data/ComplexPortal.json from the obj.params.path folder</span>
0010 <span class="comment">%                   specified in the modelAdapter.</span>
0011 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0012 <span class="comment">%                   default model adapter).</span>
0013 <span class="comment">%   verbose         logical if a summary should be shown in the Command</span>
0014 <span class="comment">%                   Window (Optional, default true)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Output:</span>
0017 <span class="comment">%   model           ecModel where model.ec.rxnEnzMat is populated with</span>
0018 <span class="comment">%                   subunit stochiometries</span>
0019 <span class="comment">%   foundComplex    complexes that fully matched between the model and the</span>
0020 <span class="comment">%                   complex data</span>
0021 <span class="comment">%   proposedComplex complexes where the model contained &gt;75% but &lt;100% of</span>
0022 <span class="comment">%                   the proteins indicated by Complex Portal, or where the</span>
0023 <span class="comment">%                   model contained more proteins than indicated for that</span>
0024 <span class="comment">%                   complex in Complex Portal.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Usage:</span>
0027 <span class="comment">%   [model, foundComplex, proposedComplex] = applyComplexData(ecModel, complexInfo, modelAdapter);</span>
0028 
0029 <span class="keyword">if</span> nargin &lt; 4 || isempty(verbose)
0030     verbose = true;
0031 <span class="keyword">end</span>
0032 
0033 <span class="keyword">if</span> nargin &lt; 3 || isempty(modelAdapter)
0034     modelAdapter = ModelAdapterManager.getDefault();
0035     <span class="keyword">if</span> isempty(modelAdapter)
0036         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0037     <span class="keyword">end</span>
0038 <span class="keyword">end</span>
0039 params = modelAdapter.params;
0040 
0041 <span class="keyword">if</span> nargin&lt;2 || isempty(complexInfo)
0042     complexInfo = fullfile(params.path,<span class="string">'data'</span>,<span class="string">'ComplexPortal.json'</span>);
0043     <span class="keyword">if</span> ~isfile(complexInfo)
0044         complexInfo = <a href="getComplexData.html" class="code" title="function complexInfo = getComplexData(taxonomicID, modelAdapter)">getComplexData</a>([], modelAdapter);
0045     <span class="keyword">end</span>
0046 <span class="keyword">end</span>
0047 
0048 <span class="keyword">if</span> ischar(complexInfo) || isstring(complexInfo)
0049     jsonStr = fileread(complexInfo);
0050     complexData = jsondecode(jsonStr);
0051 <span class="keyword">else</span>
0052     complexData = complexInfo;
0053 <span class="keyword">end</span>
0054 
0055 <span class="comment">%Remove prefixes on rxn names for gecko light</span>
0056 <span class="keyword">if</span> ~model.ec.geckoLight
0057     rxnNames = model.ec.rxns;
0058 <span class="keyword">else</span>
0059     rxnNames = extractAfter(model.ec.rxns,4);
0060 <span class="keyword">end</span>
0061 
0062 foundComplex = cell(numel(rxnNames),7);
0063 foundComplexCount = 0;
0064 proposedComplex = cell(numel(rxnNames)*2,8); <span class="comment">% Might propose more</span>
0065 proposedComplexCount = 0;
0066 
0067 complexProts = repmat({<span class="string">''</span>}, numel({complexData.complexID})*10, 1);
0068 complexMatrix = zeros(numel({complexData.complexID}),numel(complexProts));
0069 lastProt = 0;
0070 <span class="keyword">for</span> i=1:size(complexMatrix,1)
0071     <span class="comment">% Locate proteins (and add if new)</span>
0072     protIDs     = complexData(i).protID;
0073     [isOld, protMatIdx] = ismember(protIDs,complexProts);
0074     newProts    = protIDs(~isOld);
0075     complexProts(lastProt+1:lastProt+numel(newProts))=newProts;
0076     protMatIdx(~isOld)  = lastProt+1 : lastProt+numel(newProts);
0077     lastProt = lastProt + numel(newProts);
0078     <span class="comment">% Add subunit numbers</span>
0079     <span class="keyword">if</span> all(complexData(i).stochiometry == 0)
0080         complexData(i).stochiometry(:) = 1;
0081     <span class="keyword">end</span>
0082     complexMatrix(i,protMatIdx) = complexData(i).stochiometry;
0083 <span class="keyword">end</span>
0084 
0085 <span class="comment">% Remove excess space</span>
0086 complexMatrix(:,lastProt+1:end) = [];
0087 complexProts(lastProt+1:end) = [];
0088 progressbar(<span class="string">'Assign complexes to reactions'</span>)
0089 <span class="keyword">for</span> i = 1:numel(rxnNames)
0090     <span class="comment">% Get the proteins from the model</span>
0091     modelProts = model.ec.enzymes(find(model.ec.rxnEnzMat(i,:)));
0092     [protsInMat, protsIdx] = ismember(modelProts,complexProts);
0093     <span class="keyword">if</span> ~any(protsInMat)
0094         <span class="keyword">continue</span>
0095     <span class="keyword">end</span>
0096     <span class="comment">% Find complexes that includes the model proteins</span>
0097     [potComplex,~] = find(complexMatrix(:,protsIdx(protsInMat)));
0098     potComplex = unique(potComplex);
0099     <span class="comment">% Some stats on number of subunits, percentage match etc.</span>
0100     matchComplexUnits = sum(logical(complexMatrix(potComplex,protsIdx(protsInMat))),2);
0101     totalComplexUnits = sum(logical(complexMatrix(potComplex,:)),2);
0102     modComplexUnits = numel(modelProts);
0103     percMatch  = matchComplexUnits/modComplexUnits;
0104     totalMatch = totalComplexUnits/modComplexUnits;
0105     <span class="keyword">if</span> any(percMatch == 1 &amp; totalMatch == 1)
0106         <span class="comment">% Exact match</span>
0107         complexMatch = find(percMatch == 1 &amp; totalMatch == 1);
0108         <span class="keyword">if</span> numel(complexMatch)&gt;1 <span class="comment">% If more than one match, take first match</span>
0109             complexMatch = complexMatch(1);
0110         <span class="keyword">end</span>
0111         complexMatch = potComplex(complexMatch);
0112         foundComplexCount = foundComplexCount + 1;
0113         foundComplex{foundComplexCount,1} = model.ec.rxns{i};
0114         foundComplex{foundComplexCount,2} = complexData(complexMatch).complexID;
0115         foundComplex{foundComplexCount,3} = complexData(complexMatch).name;
0116         foundComplex{foundComplexCount,4} = complexData(complexMatch).geneName;
0117         foundComplex{foundComplexCount,5} = modelProts;
0118         foundComplex{foundComplexCount,6} = complexData(complexMatch).protID;
0119         foundComplex{foundComplexCount,7} = complexData(complexMatch).stochiometry;
0120 
0121         <span class="comment">% Apply in rxnEnzMat</span>
0122         [~, modelProtsIdx] = ismember(modelProts, model.ec.enzymes);
0123         model.ec.rxnEnzMat(i,modelProtsIdx) = complexData(complexMatch).stochiometry;
0124     
0125     <span class="keyword">elseif</span> modComplexUnits &gt; 1 <span class="comment">% Only suggest potential complex if grRule &gt; 1 protein</span>
0126         moreUnitsInData = find(percMatch == 1 &amp; totalMatch &gt; 1);
0127         <span class="keyword">if</span> any(moreUnitsInData)
0128             <span class="comment">% All ecModel subunits match, but Complex Portal has more subunits</span>
0129             <span class="comment">% Take the complex with the minimum number of extra subunits</span>
0130             [~,propComplex] = min(totalMatch(moreUnitsInData));
0131             propComplex     = moreUnitsInData(propComplex);
0132             selectComplex   = potComplex(propComplex);
0133             proposedComplexCount = proposedComplexCount + 1;
0134             proposedComplex{proposedComplexCount,1} = model.ec.rxns{i};
0135             proposedComplex{proposedComplexCount,2} = complexData(selectComplex).complexID;
0136             proposedComplex{proposedComplexCount,3} = complexData(selectComplex).name;
0137             proposedComplex{proposedComplexCount,4} = complexData(selectComplex).geneName;
0138             proposedComplex{proposedComplexCount,5} = modelProts;
0139             proposedComplex{proposedComplexCount,6} = complexData(selectComplex).protID;
0140             proposedComplex{proposedComplexCount,7} = complexData(selectComplex).stochiometry;
0141             proposedComplex{proposedComplexCount,8} = totalMatch(propComplex)*100;
0142         <span class="keyword">end</span>
0143         otherUnits = find(percMatch &gt;= 0.75 &amp; percMatch &lt; 1 &amp; totalMatch &lt;= 1);
0144         <span class="keyword">if</span> any(otherUnits)
0145             <span class="comment">% At least 75% of ecModels subunits match, Complex Portal maybe have less or different subunits</span>
0146             <span class="comment">% Take the complex with highest % match.</span>
0147             [~,propComplex] = max(percMatch(otherUnits));
0148             propComplex     = otherUnits(propComplex);
0149             selectComplex   = potComplex(propComplex);
0150             proposedComplexCount = proposedComplexCount + 1;
0151             proposedComplex{proposedComplexCount,1} = model.ec.rxns{i};
0152             proposedComplex{proposedComplexCount,2} = complexData(selectComplex).complexID;
0153             proposedComplex{proposedComplexCount,3} = complexData(selectComplex).name;
0154             proposedComplex{proposedComplexCount,4} = complexData(selectComplex).geneName;
0155             proposedComplex{proposedComplexCount,5} = modelProts;
0156             proposedComplex{proposedComplexCount,6} = complexData(selectComplex).protID;
0157             proposedComplex{proposedComplexCount,7} = complexData(selectComplex).stochiometry;
0158             proposedComplex{proposedComplexCount,8} = percMatch(propComplex)*100;
0159         <span class="keyword">end</span>
0160     <span class="keyword">end</span>
0161     progressbar(i/numel(rxnNames))    
0162 <span class="keyword">end</span>
0163 progressbar(1) <span class="comment">% Make sure it closes</span>
0164 
0165 <span class="comment">% Remove empty space</span>
0166 foundComplex(foundComplexCount+1:<span class="keyword">end</span>,:) = [];
0167 proposedComplex(proposedComplexCount+1:<span class="keyword">end</span>,:) = [];
0168 
0169 rowHeadings = {<span class="string">'rxn'</span>, <span class="string">'complexID'</span>,<span class="string">'name'</span>,<span class="string">'genes'</span>,<span class="string">'protID_model'</span>,<span class="string">'protID_complex'</span>,<span class="string">'stochiometry'</span>};
0170 
0171 foundComplex = cell2table(foundComplex, <span class="string">'VariableNames'</span>, rowHeadings);
0172 
0173 proposedComplex = cell2table(proposedComplex, <span class="string">'VariableNames'</span>, [rowHeadings <span class="string">'match'</span>]);
0174 <span class="keyword">if</span> verbose
0175     disp([<span class="string">'A total of '</span> int2str(numel(foundComplex(:,1))) <span class="string">' complex have full match, and '</span> int2str(numel(proposedComplex(:,1))) <span class="string">' proposed.'</span>])
0176 <span class="keyword">end</span>
0177 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>