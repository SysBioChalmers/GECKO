<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of applyComplexData</title>
  <meta name="keywords" content="applyComplexData">
  <meta name="description" content="applyComplexData">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">geckomat</a> &gt; <a href="index.html">change_model</a> &gt; applyComplexData.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\geckomat\change_model&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>applyComplexData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>applyComplexData</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [model, foundComplex, proposedComplex] = applyComplexData(model, complexInfo, modelAdapter, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> applyComplexData
   Apply stochiometry for complex in an ecModel

 Input:
   model           an ecModel in GECKO 3 format (with ecModel.ec structure)
   complexInfo     structure as generated by getComplexData. If nothing
                   is provided, an attempt will be made to read
                   data/ComplexPortal.json from the obj.params.path folder
                   specified in the modelAdapter.
   modelAdapter    a loaded model adapter (Optional, will otherwise use the
                   default model adapter).
   verbose         logical if a summary should be shown in the Command
                   Window (Optional, default true)

 Output:
   model           ecModel where model.ec.rxnEnzMat is populated with
                   subunit stochiometries
   foundComplex    complexes that fully matched between the model and the
                   complex data
   proposedComplex complexes where the model contained &gt;75% but &lt;100% of
                   the proteins indicated by Complex Portal, or where the
                   model contained more proteins than indicated for that
                   complex in Complex Portal.

 Usage:
   [model, foundComplex, proposedComplex] = applyComplexData(ecModel, complexInfo, modelAdapter);</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getComplexData.html" class="code" title="function complexInfo = getComplexData(organism, modelAdapter)">getComplexData</a>	getComplexData</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [model, foundComplex, proposedComplex] = applyComplexData(model, complexInfo, modelAdapter, verbose)</a>
0002 <span class="comment">% applyComplexData</span>
0003 <span class="comment">%   Apply stochiometry for complex in an ecModel</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model           an ecModel in GECKO 3 format (with ecModel.ec structure)</span>
0007 <span class="comment">%   complexInfo     structure as generated by getComplexData. If nothing</span>
0008 <span class="comment">%                   is provided, an attempt will be made to read</span>
0009 <span class="comment">%                   data/ComplexPortal.json from the obj.params.path folder</span>
0010 <span class="comment">%                   specified in the modelAdapter.</span>
0011 <span class="comment">%   modelAdapter    a loaded model adapter (Optional, will otherwise use the</span>
0012 <span class="comment">%                   default model adapter).</span>
0013 <span class="comment">%   verbose         logical if a summary should be shown in the Command</span>
0014 <span class="comment">%                   Window (Optional, default true)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Output:</span>
0017 <span class="comment">%   model           ecModel where model.ec.rxnEnzMat is populated with</span>
0018 <span class="comment">%                   subunit stochiometries</span>
0019 <span class="comment">%   foundComplex    complexes that fully matched between the model and the</span>
0020 <span class="comment">%                   complex data</span>
0021 <span class="comment">%   proposedComplex complexes where the model contained &gt;75% but &lt;100% of</span>
0022 <span class="comment">%                   the proteins indicated by Complex Portal, or where the</span>
0023 <span class="comment">%                   model contained more proteins than indicated for that</span>
0024 <span class="comment">%                   complex in Complex Portal.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Usage:</span>
0027 <span class="comment">%   [model, foundComplex, proposedComplex] = applyComplexData(ecModel, complexInfo, modelAdapter);</span>
0028 
0029 <span class="keyword">if</span> nargin &lt; 4 || isempty(verbose)
0030     verbose = true;
0031 <span class="keyword">end</span>
0032 
0033 <span class="keyword">if</span> nargin &lt; 3 || isempty(modelAdapter)
0034     modelAdapter = ModelAdapterManager.getDefault();
0035     <span class="keyword">if</span> isempty(modelAdapter)
0036         error(<span class="string">'Either send in a modelAdapter or set the default model adapter in the ModelAdapterManager.'</span>)
0037     <span class="keyword">end</span>
0038 <span class="keyword">end</span>
0039 params = modelAdapter.params;
0040 
0041 <span class="keyword">if</span> nargin&lt;2 || isempty(complexInfo)
0042     complexInfo = fullfile(params.path,<span class="string">'data'</span>,<span class="string">'ComplexPortal.json'</span>);
0043     <span class="keyword">if</span> ~isfile(complexInfo)
0044         complexInfo = <a href="getComplexData.html" class="code" title="function complexInfo = getComplexData(organism, modelAdapter)">getComplexData</a>([], modelAdapter);
0045     <span class="keyword">end</span>
0046 <span class="keyword">end</span>
0047 
0048 <span class="keyword">if</span> ischar(complexInfo) || isstring(complexInfo)
0049     jsonStr = fileread(complexInfo);
0050     complexData = jsondecode(jsonStr);
0051 <span class="keyword">else</span>
0052     complexData = complexInfo;
0053 <span class="keyword">end</span>
0054 
0055 
0056 foundComplex = cell(0,7);
0057 proposedComplex = cell(0,8);
0058 
0059 <span class="comment">%Remove prefixes on rxn names for gecko light</span>
0060 <span class="keyword">if</span> ~model.ec.geckoLight
0061     rxnNames = model.ec.rxns;
0062 <span class="keyword">else</span>
0063     rxnNames = extractAfter(model.ec.rxns,4);
0064 <span class="keyword">end</span>
0065 
0066 progressbar(<span class="string">'Assign complexes to reactions'</span>)
0067 <span class="keyword">for</span> i = 1:numel(rxnNames)
0068     bestComplexIdx = 0;
0069     bestMatch = 0;
0070     protIdsComplex = [];
0071 
0072     <span class="comment">%if numel(genes) &gt; 1</span>
0073     idxProts = model.ec.rxnEnzMat(i,:) ~= 0;
0074 
0075     <span class="keyword">if</span> any(idxProts)
0076         protIdsModel = model.ec.enzymes(idxProts);
0077 
0078         <span class="keyword">for</span> j = 1:size(complexData, 1)
0079 
0080             protIdsComplex = complexData(j).protID;
0081 
0082             C = intersect(protIdsModel, protIdsComplex);
0083 
0084             <span class="comment">% Determine the match percentage bewteen the proteins in the</span>
0085             <span class="comment">% model and the proteins in complex data</span>
0086             <span class="keyword">if</span> numel(C) == numel(protIdsModel) &amp;&amp; numel(C) == numel(protIdsComplex)
0087                 match = 1;
0088             <span class="keyword">else</span>
0089                 <span class="keyword">if</span> numel(protIdsModel) &lt; numel(protIdsComplex)
0090                     match = numel(C) / numel(protIdsComplex);
0091                 <span class="keyword">else</span>
0092                     match = numel(C) / numel(protIdsModel);
0093                 <span class="keyword">end</span>
0094             <span class="keyword">end</span>
0095 
0096             <span class="comment">% Check if the protID match with the complex data based on match % higher than</span>
0097             <span class="comment">% 75%. Pick the highest match.</span>
0098             <span class="keyword">if</span> match &gt;= 0.75 &amp;&amp; match &gt; bestMatch
0099                 bestComplexIdx = j;
0100                 bestMatch = match*100;
0101                 <span class="comment">% In some cases all the model proteins are in the</span>
0102                 <span class="comment">% complex data, but they are less than those in the</span>
0103                 <span class="comment">% complex data.</span>
0104                 <span class="keyword">if</span> match == 1 &amp;&amp; numel(protIdsModel) == numel(protIdsComplex)
0105                     <span class="keyword">break</span>
0106                 <span class="keyword">end</span>
0107             <span class="keyword">end</span>
0108         <span class="keyword">end</span>
0109 
0110         <span class="keyword">if</span> bestMatch &gt;= 75
0111             <span class="comment">% Only get data with full match in the model and the</span>
0112             <span class="comment">% complex data. In some cases all the model proteins are in</span>
0113             <span class="comment">% the complex data, but they are less than those in complex data</span>
0114             <span class="keyword">if</span> bestMatch == 100 &amp;&amp; numel(complexData(bestComplexIdx).protID) == numel(protIdsComplex)
0115                 foundComplex(end+1,1) = {model.ec.rxns{i}};
0116                 foundComplex(<span class="keyword">end</span>,2) = {complexData(bestComplexIdx).complexID};
0117                 foundComplex(<span class="keyword">end</span>,3) = {complexData(bestComplexIdx).name};
0118                 foundComplex(<span class="keyword">end</span>,4) = {complexData(bestComplexIdx).geneName};
0119                 foundComplex(<span class="keyword">end</span>,5) = {protIdsModel};
0120                 foundComplex(<span class="keyword">end</span>,6) = {complexData(bestComplexIdx).protID};
0121                 foundComplex(<span class="keyword">end</span>,7) = {complexData(bestComplexIdx).stochiometry};
0122 
0123                 <span class="comment">% Some complex match in 100% but there is not stochiometry</span>
0124                 <span class="comment">% reported. In this case, assign a value of 1.</span>
0125                 assignS = [complexData(bestComplexIdx).stochiometry];
0126                 assignS(assignS == 0) = 1;
0127                 model.ec.rxnEnzMat(i,idxProts) = assignS;
0128             <span class="keyword">else</span>
0129                 proposedComplex(end+1,1) = {model.ec.rxns{i}};
0130                 proposedComplex(<span class="keyword">end</span>,2) = {complexData(bestComplexIdx).complexID};
0131                 proposedComplex(<span class="keyword">end</span>,3) = {complexData(bestComplexIdx).name};
0132                 proposedComplex(<span class="keyword">end</span>,4) = {complexData(bestComplexIdx).geneName};
0133                 proposedComplex(<span class="keyword">end</span>,5) = {protIdsModel};
0134                 proposedComplex(<span class="keyword">end</span>,6) = {complexData(bestComplexIdx).protID};
0135                 proposedComplex(<span class="keyword">end</span>,7) = {complexData(bestComplexIdx).stochiometry};
0136                 proposedComplex(<span class="keyword">end</span>,8) = {bestMatch};
0137             <span class="keyword">end</span>
0138 
0139         <span class="keyword">end</span>
0140     <span class="keyword">end</span>
0141     progressbar(i/numel(rxnNames))
0142 <span class="keyword">end</span>
0143 
0144 rowHeadings = {<span class="string">'rxn'</span>, <span class="string">'complexID'</span>,<span class="string">'name'</span>,<span class="string">'genes'</span>,<span class="string">'protID_model'</span>,<span class="string">'protID_complex'</span>,<span class="string">'stochiometry'</span>};
0145 
0146 foundComplex = cell2table(foundComplex, <span class="string">'VariableNames'</span>, rowHeadings);
0147 
0148 proposedComplex = cell2table(proposedComplex, <span class="string">'VariableNames'</span>, [rowHeadings <span class="string">'match'</span>]);
0149 <span class="keyword">if</span> verbose
0150     disp([<span class="string">'A total of '</span> int2str(numel(foundComplex(:,1))) <span class="string">' complex have full match, and '</span> int2str(numel(proposedComplex(:,1))) <span class="string">' proposed.'</span>])
0151 <span class="keyword">end</span>
0152 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>